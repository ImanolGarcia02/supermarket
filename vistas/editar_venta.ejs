<%- include('header') %>

<div class="text-center mb-3">
  <img src="https://cdn-icons-png.flaticon.com/512/2280/2280532.png" alt="Editar venta" style="width: 70px;">
</div>

<div class="row">
  <div class="col-md-6">
    <h2 class="mb-4">Corregir Venta</h2>

    <form action="/ventas/<%= venta._id %>?_method=PUT" method="POST">

      <!-- Selección de producto -->
      <label for="productoId" class="form-label">Item:</label>
      <select id="productoId" name="productoId" class="form-select" required>
      <% if (!venta.productoId) { %>
      <!-- Si el producto fue eliminado -->
      <option selected disabled>Producto no disponible</option>
   <% } %>

  <% productos.forEach(producto => { %>
    <option value="<%= producto._id %>"
      <%= venta.productoId && String(venta.productoId._id) === String(producto._id) ? 'selected' : '' %>>
        <%= producto.nombre %> -
        <%= producto.precio ? `$${producto.precio.toFixed(2)}` : "Precio no disponible" %>
     </option>
   <% }); %>
  </select>


      <br>

      <!-- Cliente -->
      <label for="cliente" class="form-label">Comprador:</label>
      <input type="text" id="cliente" name="cliente" class="form-control" 
             value="<%= venta.cliente %>" required>

      <br>

      <!-- Cantidad -->
      <label for="cantidad" class="form-label">Cuántos:</label>
      <input type="number" id="cantidad" name="cantidad" class="form-control"
             value="<%= venta.cantidad %>" required min="1">

      <br>

      <!-- Botones -->
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Actualizar</button>
        <a href="/ventas" class="btn btn-secondary">Cancelar</a>
      </div>

    </form>

  </div>
</div>
